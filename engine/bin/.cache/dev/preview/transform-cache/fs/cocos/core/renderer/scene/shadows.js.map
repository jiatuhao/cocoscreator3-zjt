{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/shadows.ts"],"names":["Material","Sphere","Color","Mat4","Vec3","Vec2","legacyCC","Enum","ShadowsPool","NULL_HANDLE","ShadowsView","multiPatches","name","value","ShadowType","Planar","ShadowMap","PCFType","HARD","FILTER_X5","FILTER_X9","FILTER_X25","SHADOW_TYPE_NONE","Shadows","get","_handle","ENABLE","val","set","TYPE","activate","_normal","copy","setVec3","NORMAL","DISTANCE","_shadowColor","color","setVec4","COLOR","enabled","NEAR","FAR","ASPECT","ORTHO_SIZE","_size","setVec2","SIZE","PCF_TYPE","SHADOW_MAP_DIRTY","BIAS","AUTO_ADAPT","_matLight","_material","_instancingMaterial","sphere","maxReceived","alloc","getPlanarShader","patches","initialize","effectName","PLANAR_PASS","passes","handle","getShaderVariant","shadowsInfo","type","near","far","aspect","orthoSize","shadowMapSize","pcf","normal","distance","shadowColor","bias","autoAdapt","_updatePipeline","_updatePlanarInfo","root","director","pipeline","macros","CC_RECEIVE_SHADOW","onGlobalPipelineStateChanged","defines","USE_INSTANCING","INSTANCE_PASS","destroy","free","MAX_FAR","COEFFICIENT_OF_EXPANSION","Math","sqrt"],"mappings":"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"}