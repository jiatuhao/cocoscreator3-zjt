{"version":3,"sources":["../../../../../../../../../../cocos/core/pipeline/forward/forward-stage.ts"],"names":["ccclass","displayOrder","type","serializable","SetIndex","getPhaseID","opaqueCompareFn","RenderQueue","transparentCompareFn","ClearFlag","Color","Rect","SRGBToLinear","RenderBatchedQueue","RenderInstancedQueue","RenderStage","ForwardStagePriority","RenderAdditiveLightQueue","InstancedBuffer","BatchedBuffer","BatchingSchemes","RenderQueueDesc","RenderQueueSortMode","PlanarShadowQueue","UIPhase","colors","ForwardStage","_renderQueues","_renderArea","_batchedQueue","_instancedQueue","_phaseID","_clearFlag","_uiPhase","initialize","info","renderQueues","activate","pipeline","flow","i","length","phase","j","stages","sortFunc","sortMode","BACK_TO_FRONT","FRONT_TO_BACK","isTransparent","phases","_additiveLightQueue","_pipeline","_planarQueue","destroy","render","camera","clear","device","forEach","renderQueueClearFunc","renderObjects","m","p","k","ro","subModels","model","subModel","passes","pass","batchingScheme","INSTANCING","instancedBuffer","get","merge","instancedAttributes","queue","add","VB_MERGING","batchedBuffer","insertRenderPass","renderQueueSortFunc","cmdBuff","commandBuffers","uploadBuffers","gatherLightPasses","gatherShadowPasses","vp","viewport","w","window","hasOnScreenAttachments","surfaceTransform","height","width","h","x","y","shadingScale","clearFlag","COLOR","isHDR","clearColor","scale","fpScale","exposure","z","framebuffer","renderPass","colorTextures","getRenderPass","beginRenderPass","clearDepth","clearStencil","bindDescriptorSet","GLOBAL","descriptorSet","recordCommandBuffer","endRenderPass","rq","sort","initInfo","name","priority","FORWARD","tag"],"mappings":"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"}