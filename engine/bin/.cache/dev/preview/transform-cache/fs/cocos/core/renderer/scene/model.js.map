{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/model.ts"],"names":["uploadMat4AsVec4x3","mat","v1","v2","v3","m00","m01","m02","m12","m04","m05","m06","m13","m08","m09","m10","m14","builtinResMgr","AABB","Pool","Layers","SubModel","BatchingSchemes","legacyCC","InstancedBuffer","Mat4","Vec4","genSamplerHash","samplerLib","ShaderPool","SubModelPool","SubModelView","SubModelArrayPool","ModelPool","ModelView","AABBPool","AABBView","NULL_HANDLE","AttributeArrayPool","RawBufferPool","freeHandleArray","ObjectPool","PoolType","Attribute","BufferInfo","INST_MAT_WORLD","UBOLocal","UNIFORM_LIGHTMAP_TEXTURE_BINDING","getTypedArrayConstructor","BufferUsageBit","FormatInfos","MemoryUsageBit","Filter","Address","Feature","AttrPool","ATTRIBUTE","_","obj","m4_1","_subModelPool","shadowMapPatches","name","value","ModelType","lightmapSamplerHash","LINEAR","NONE","CLAMP","lightmapSamplerWithMipHash","Model","_subModels","_inited","_worldBounds","_modelBounds","_localBuffer","_updateStamp","_instMatWorldIdx","get","_handle","RECEIVE_SHADOW","val","set","onMacroPatchesStateChanged","CAST_SHADOW","_node","n","NODE","handle","_transform","TRANSFORM","VIS_FLAGS","ENABLED","type","DEFAULT","scene","isDynamicBatching","instancedAttributes","buffer","views","attributes","_device","_descriptorSetCount","_transformUpdated","_hWorldBounds","_localData","Float32Array","COUNT","_lightmap","_lightmapUVParam","director","root","device","initialize","alloc","hSubModelArray","hInstancedAttrArray","INSTANCED_ATTR_ARRAY","SUB_MODEL_ARRAY","Enum","destroy","subModels","i","length","subModel","free","hOldBuffer","INSTANCED_BUFFER","hAttrArray","attachToScene","detachFromScene","updateTransform","stamp","node","transform","hasChangedFlags","_dirtyFlags","updateWorldTransform","worldBounds","_mat","_pos","_rot","_scale","setVec3","CENTER","center","HALF_EXTENSION","halfExtents","updateWorldBound","updateUBOs","update","worldMatrix","idx","attrs","toArray","MAT_WORLD_OFFSET","inverseTranspose","MAT_WORLD_IT_OFFSET","createBoundingShape","minPos","maxPos","fromPoints","create","clone","WORLD_BOUNDS","initSubModel","subMeshData","isNewSubModel","passes","getMacroPatches","initPlanarShadowShader","_updateAttributesAndBinding","assign","setSubModelMesh","subMesh","setSubModelMaterial","onGlobalPipelineStateChanged","onPipelineStateChanged","updateLightingmap","texture","uvParam","LIGHTINGMAP_UVPARAM","gfxTexture","getGFXTexture","sampler","getSampler","mipmaps","descriptorSet","bindTexture","bindSampler","subModelIndex","receiveShadow","_initLocalDescriptors","_updateLocalDescriptors","shader","SHADER_0","_updateInstancedAttributes","_getInstancedAttributeIndex","pass","hasFeature","INSTANCED_ARRAYS","size","j","attribute","isInstanced","format","hBuffer","getBuffer","Uint8Array","offset","hAttr","attr","isNormalized","location","push","info","count","batchingScheme","INSTANCING","createBuffer","UNIFORM","TRANSFER_DST","HOST","DEVICE","SIZE","bindBuffer","BINDING"],"mappings":"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"}