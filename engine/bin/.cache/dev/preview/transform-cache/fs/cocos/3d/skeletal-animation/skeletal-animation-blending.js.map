{"version":3,"sources":["../../../../../../../../../cocos/3d/skeletal-animation/skeletal-animation-blending.ts"],"names":["createBlendStateWriter","blendState","node","property","host","constants","blendFunction","isVec3Property","additive3D","additiveQuat","propertyBlendState","ref","isConstCacheValid","lastWeight","destroy","assertIsNonNullable","deRef","forTarget","get","set","value","enabled","weight","markAsDirty","isQuatProperty","isEmptyNodeBlendState","nodeBlendState","properties","position","rotation","eulerAngles","scale","Vec3","zero","copy","scaleAndAdd","Quat","identity","t","slerp","BlendStateBuffer","_nodeBlendStates","Map","_states","Set","dirty","PropertyBlendState","refCount","apply","forEach","s","r","anyChanged","setRTS","state","onBlendFinished","bindState","add","unbindState","_node"],"mappings":"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"}