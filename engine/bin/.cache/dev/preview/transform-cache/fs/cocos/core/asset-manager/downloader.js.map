{"version":3,"sources":["../../../../../../../../../cocos/core/asset-manager/downloader.ts"],"names":["EDITOR","sys","js","callInNextTick","basename","Cache","downloadDomImage","downloadFile","downloadScript","files","retry","urlAppendTimestamp","legacyCC","REGEX","downloadImage","url","options","onComplete","func","capabilities","imageBitmap","assetManager","allowImageBitmap","downloadBlob","xhrResponseType","onFileProgress","downloadJson","downloadArrayBuffer","downloadText","downloadBundle","nameOrUrl","bundleName","test","downloader","remoteBundles","indexOf","remoteServerAddress","version","bundleVers","count","config","out","error","err","response","base","jspath","importBundleEntry","then","e","Downloader","maxConcurrency","maxRequestsPerFrame","maxRetryCount","appendTimeStamp","limited","retryInterval","downloadDomAudio","_downloaders","bundle","_downloading","_queue","_queueDirty","_totalNum","_totalNumThisPeriod","_lastDate","_checkNextPeriod","_remoteServerAddress","_maxInterval","init","clear","length","register","type","handler","mixin","download","id","file","get","downloadCallbacks","push","request","find","x","priority","process","index","callback","add","_updateTime","done","data","_handleQueueInNextFrame","finale","result","callbacks","remove","i","l","loadSubpackage","name","completeCallback","loadBundle","now","Date","deltaTime","director","getDeltaTime","interval","_handleQueue","sort","a","b","pop","bind"],"mappings":"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"}