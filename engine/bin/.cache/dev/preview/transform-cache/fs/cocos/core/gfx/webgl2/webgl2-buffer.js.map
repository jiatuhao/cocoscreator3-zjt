{"version":3,"sources":["../../../../../../../../../../cocos/core/gfx/webgl2/webgl2-buffer.ts"],"names":["Buffer","IndirectBuffer","BufferFlagBit","BufferUsageBit","WebGL2CmdFuncCreateBuffer","WebGL2CmdFuncDestroyBuffer","WebGL2CmdFuncResizeBuffer","WebGL2CmdFuncUpdateBuffer","WebGL2Buffer","_gpuBuffer","initialize","info","_isBufferView","buffer","_usage","usage","_memUsage","memUsage","_size","_stride","range","_count","_flags","flags","size","stride","_bakcupBuffer","indirects","gpuBuffer","glTarget","glBuffer","glOffset","offset","Math","max","INDIRECT","_indirectBuffer","BAKUP_BUFFER","Uint8Array","_device","memoryStatus","bufferSize","drawInfos","destroy","resize","console","warn","oldSize","oldView","set","update","buffSize","undefined","byteLength","view"],"mappings":"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"}