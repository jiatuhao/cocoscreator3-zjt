{"version":3,"sources":["../../../../../../../../../../cocos/core/pipeline/forward/planar-shadow-queue.ts"],"names":["AABB","intersect","SetIndex","InstancedBuffer","PipelineStateManager","DSPool","ShaderPool","PassPool","PassView","RenderInstancedQueue","ShadowType","Layers","_ab","PlanarShadowQueue","pipeline","_pendingModels","_instancedQueue","_pipeline","gatherShadowPasses","camera","cmdBuff","shadows","length","enabled","type","Planar","updateShadowUBO","scene","frstm","frustum","shadowVisible","visibility","BitMask","DEFAULT","mainLight","models","renderObjects","instancedBuffer","get","instancingMaterial","passes","clear","queue","add","i","model","node","castShadow","worldBounds","transform","matLight","aabbFrustum","isInstancingEnabled","j","subModels","merge","instancedAttributes","push","uploadBuffers","recordCommandBuffer","device","renderPass","pass","material","descriptorSet","handle","DESCRIPTOR_SET","bindDescriptorSet","MATERIAL","modelCount","subModel","shader","planarShaderHandel","ia","inputAssembler","pso","getOrCreatePipelineState","bindPipelineState","LOCAL","bindInputAssembler","draw"],"mappings":"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"}