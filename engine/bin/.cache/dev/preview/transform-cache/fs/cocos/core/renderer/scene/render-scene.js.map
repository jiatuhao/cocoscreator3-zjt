{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/render-scene.ts"],"names":["TransformBit","ScenePool","SceneView","ModelArrayPool","NULL_HANDLE","UIBatchArrayPool","LightArrayPool","RenderScene","registerCreateFunc","root","_createSceneFun","_root","_name","_cameras","_mainLight","_sphereLights","_spotLights","_models","_scenePoolHandle","_batches","_directionalLights","_modelId","_modelArrayHandle","_batchArrayHandle","_sphereLightsHandle","_spotLightsHandle","_createHandles","initialize","info","name","update","stamp","mainLight","sphereLights","i","length","light","spotLights","models","model","enabled","updateTransform","updateUBOs","destroy","removeCameras","removeSphereLights","removeSpotLights","removeModels","free","addCamera","cam","attachToScene","push","removeCamera","camera","splice","detachFromScene","setMainLight","dl","set","MAIN_LIGHT","handle","unsetMainLight","dlList","node","hasChangedFlags","ROTATION","addDirectionalLight","removeDirectionalLight","addSphereLight","pl","removeSphereLight","erase","addSpotLight","sl","removeSpotLight","clear","addModel","m","removeModel","addBatch","batch","removeBatch","removeBatches","onGlobalPipelineStateChanged","generateModelId","alloc","MODEL_ARRAY","SPOT_LIGHT_ARRAY","SPHERE_LIGHT_ARRAY","BATCH_ARRAY_2D"],"mappings":"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"}