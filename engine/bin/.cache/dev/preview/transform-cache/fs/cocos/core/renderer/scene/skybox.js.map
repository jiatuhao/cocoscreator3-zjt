{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/skybox.ts"],"names":["builtinResMgr","Material","UNIFORM_ENVIRONMENT_BINDING","MaterialInstance","samplerLib","legacyCC","SkyboxPool","NULL_HANDLE","SkyboxView","skybox_mesh","skybox_material","Skybox","_model","get","_handle","ENABLE","val","activate","_updatePipeline","set","USE_IBL","IS_RGBE","recompileShaders","USE_RGBE_CUBEMAP","setSubModelMaterial","_envmap","_default","director","root","pipeline","ambient","albedoArray","mipmapLevel","_updateGlobalBinding","_globalDescriptorSet","alloc","initialize","skyboxInfo","enabled","useIBL","isRGBE","envmap","descriptorSet","createModel","renderer","scene","Model","_initLocalDescriptors","MODEL","handle","groundAlbedo","mat","effectName","defines","parent","utils","createMesh","primitives","box","width","height","length","initSubModel","renderingSubMeshes","value","current","macros","CC_USE_IBL","onGlobalPipelineStateChanged","texture","getGFXTexture","sampler","getSampler","_device","getSamplerHash","bindSampler","bindTexture","destroy","free"],"mappings":"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"}