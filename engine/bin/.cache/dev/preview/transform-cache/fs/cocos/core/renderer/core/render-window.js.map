{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/core/render-window.ts"],"names":["TextureType","TextureUsageBit","Format","TextureInfo","FramebufferInfo","RenderWindowPool","RenderWindowView","FramebufferPool","NULL_HANDLE","RenderWindow","registerCreateFunc","root","_createWindowFun","_root","_width","_height","get","_poolHandle","FRAMEBUFFER","_shouldSyncSizeWithSwapchain","HAS_ON_SCREEN_ATTACHMENTS","HAS_OFF_SCREEN_ATTACHMENTS","_cameras","_title","_nativeWidth","_nativeHeight","_renderPass","_colorTextures","_depthStencilTexture","_swapchainBufferIndices","initialize","device","info","alloc","title","undefined","swapchainBufferIndices","shouldSyncSizeWithSwapchain","width","height","renderPassInfo","colorAttachments","depthStencilAttachment","i","length","format","UNKNOWN","colorFormat","depthStencilFormat","createRenderPass","colorTex","createTexture","TEX2D","COLOR_ATTACHMENT","SAMPLED","set","push","DEPTH_STENCIL_ATTACHMENT","hFBO","destroy","clearCameras","colorTexture","resize","needRebuild","framebuffer","camera","isWindowSize","extractRenderCameras","cameras","j","enabled","update","attachCamera","sortCameras","detachCamera","splice","sort","a","b","priority"],"mappings":"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"}