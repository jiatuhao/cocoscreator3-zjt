{"version":3,"sources":["../../../../../../../../../../cocos/core/pipeline/forward/forward-pipeline.ts"],"names":["ccclass","displayOrder","type","serializable","RenderPipeline","ForwardFlow","RenderTextureConfig","MaterialConfig","ShadowFlow","UBOGlobal","UBOShadow","UBOCamera","UNIFORM_SHADOWMAP_BINDING","UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING","BufferUsageBit","MemoryUsageBit","ClearFlag","Filter","Address","StoreOp","ColorAttachment","DepthStencilAttachment","LoadOp","TextureLayout","RenderPassInfo","BufferInfo","Feature","SKYBOX_FLAG","legacyCC","Color","Mat4","Vec3","Vec4","Fog","Ambient","Skybox","Shadows","ShadowType","getShadowWorldMatrix","updatePlanarPROJ","genSamplerHash","samplerLib","builtinResMgr","errorID","matShadowView","matShadowViewProj","vec3_center","_samplerInfo","LINEAR","NONE","CLAMP","ForwardPipeline","fog","ambient","skybox","shadows","renderObjects","shadowObjects","shadowFrameBufferMap","Map","_isHDR","_shadingScale","_fpScale","_renderPasses","_globalUBO","Float32Array","COUNT","_cameraUBO","_shadowUBO","initialize","info","_flows","length","shadowFlow","initInfo","push","forwardFlow","activate","_macros","_activeRenderer","render","cameras","_commandBuffers","begin","updateGlobalUBO","i","camera","scene","updateCameraUBO","j","end","_device","queue","submit","getRenderPass","clearFlags","renderPass","get","device","colorAttachment","depthStencilAttachment","format","colorFormat","depthStencilFormat","stencilStoreOp","DISCARD","depthStoreOp","COLOR","loadOp","LOAD","beginLayout","PRESENT_SRC","DEPTH_STENCIL","DEPTH","depthLoadOp","STENCIL","stencilLoadOp","DEPTH_STENCIL_ATTACHMENT_OPTIMAL","renderPassInfo","createRenderPass","set","_descriptorSet","update","root","director","fv","shadingWidth","Math","floor","width","shadingHeight","height","TIME_OFFSET","cumulativeTime","frameTime","getTotalFrames","SCREEN_SIZE_OFFSET","NATIVE_SIZE_OFFSET","updateBuffer","getBuffer","BINDING","commandBuffer","globalUBO","createBuffer","UNIFORM","TRANSFER_DST","HOST","DEVICE","SIZE","bindBuffer","cameraUBO","shadowUBO","shadowMapSamplerHash","shadowMapSampler","getSampler","bindSampler","bindTexture","getGFXTexture","macros","CC_USE_HDR","CC_SUPPORT_FLOAT_TEXTURE","hasFeature","TEXTURE_FLOAT","updateShadowUBO","mainLight","shadowInfo","enabled","ShadowMap","has","colorTextures","shadowCameraView","x","y","far","autoAdapt","node","getWorldRotation","direction","radius","sphere","aspect","halfFar","distance","center","min","COEFFICIENT_OF_EXPANSION","MAX_FAR","getWorldMatrix","orthoSize","invert","projectionSignY","screenSpaceSignY","UVSpaceSignY","ortho","near","clipSpaceMinZ","multiply","toArray","MAT_LIGHT_VIEW_PROJ_OFFSET","SHADOW_INFO_OFFSET","size","pcf","bias","Planar","shadowColor","SHADOW_COLOR_OFFSET","getScene","renderScene","cv","exposure","SCREEN_SCALE_OFFSET","shadingScale","EXPOSURE_OFFSET","MAIN_LIT_DIR_OFFSET","color","MAIN_LIT_COLOR_OFFSET","useColorTemperature","colorTempRGB","colorTemperatureRGB","z","illuminance","UNIT_Z","ZERO","skyColor","colorArray","skyIllum","AMBIENT_SKY_OFFSET","albedoArray","AMBIENT_GROUND_OFFSET","matView","MAT_VIEW_OFFSET","worldMatrix","MAT_VIEW_INV_OFFSET","matProj","MAT_PROJ_OFFSET","matProjInv","MAT_PROJ_INV_OFFSET","matViewProj","MAT_VIEW_PROJ_OFFSET","matViewProjInv","MAT_VIEW_PROJ_INV_OFFSET","position","CAMERA_POS_OFFSET","window","hasOffScreenAttachments","GLOBAL_FOG_COLOR_OFFSET","GLOBAL_FOG_BASE_OFFSET","fogStart","fogEnd","fogDensity","GLOBAL_FOG_ADD_OFFSET","fogTop","fogRange","fogAtten","destroyUBOs","destroy","getTexture","rpIter","values","rpRes","next","done","value","val","defaultGlobalUBOData"],"mappings":";;;;;;;;;;;;;;;;;;;;;AA8BSA,MAAAA,O,0BAAAA,O;AAASC,MAAAA,Y,0BAAAA,Y;AAAcC,MAAAA,I,0BAAAA,I;AAAMC,MAAAA,Y,0BAAAA,Y;;AAC7BC,MAAAA,c,qBAAAA,c;;AACAC,MAAAA,W,kBAAAA,W;;AACAC,MAAAA,mB,4BAAAA,mB;AAAqBC,MAAAA,c,4BAAAA,c;;AACrBC,MAAAA,U,uBAAAA,U;;AACeC,MAAAA,S,aAAAA,S;AAAWC,MAAAA,S,aAAAA,S;AAAWC,MAAAA,S,aAAAA,S;AAAWC,MAAAA,yB,aAAAA,yB;AAA2BC,MAAAA,yC,aAAAA,yC;;AAC3EC,MAAAA,c,gBAAAA,c;AAAgBC,MAAAA,c,gBAAAA,c;AAAgBC,MAAAA,S,gBAAAA,S;AAAWC,MAAAA,M,gBAAAA,M;AAAQC,MAAAA,O,gBAAAA,O;AAASC,MAAAA,O,gBAAAA,O;;AAC5DC,MAAAA,e,eAAAA,e;AAAiBC,MAAAA,sB,eAAAA,sB;AAAoCC,MAAAA,M,eAAAA,M;AAAQC,MAAAA,a,eAAAA,a;AAClEC,MAAAA,c,eAAAA,c;AAAgBC,MAAAA,U,eAAAA,U;AAAYC,MAAAA,O,eAAAA,O;;AACvBC,MAAAA,W,0BAAAA,W;;AACAC,MAAAA,Q,oBAAAA,Q;;AACAC,MAAAA,K,gBAAAA,K;AAAOC,MAAAA,I,gBAAAA,I;AAAMC,MAAAA,I,gBAAAA,I;AAAMC,MAAAA,I,gBAAAA,I;;AACnBC,MAAAA,G,uBAAAA,G;;AACAC,MAAAA,O,2BAAAA,O;;AACAC,MAAAA,M,0BAAAA,M;;AACAC,MAAAA,O,2BAAAA,O;AAASC,MAAAA,U,2BAAAA,U;;AACTC,MAAAA,oB,mBAAAA,oB;AAAsBC,MAAAA,gB,mBAAAA,gB;;AAEtBC,MAAAA,c,6BAAAA,c;AAAgBC,MAAAA,U,6BAAAA,U;;AAChBC,MAAAA,a,mBAAAA,a;;AAGAC,MAAAA,O,oBAAAA,O;;;AAEHC,MAAAA,a,GAAgB,IAAId,IAAJ,E;AAChBe,MAAAA,iB,GAAoB,IAAIf,IAAJ,E;AACpBgB,MAAAA,W,GAAc,IAAIf,IAAJ,E;AAEdgB,MAAAA,Y,GAAe,CACjB9B,MAAM,CAAC+B,MADU,EAEjB/B,MAAM,CAAC+B,MAFU,EAGjB/B,MAAM,CAACgC,IAHU,EAIjB/B,OAAO,CAACgC,KAJS,EAKjBhC,OAAO,CAACgC,KALS,EAMjBhC,OAAO,CAACgC,KANS,C;AASrB;AACA;AACA;AACA;;iCAEaC,e,WADZnD,OAAO,CAAC,iBAAD,C,UAgCHE,IAAI,CAAC,CAACI,mBAAD,CAAD,C,UAEJL,YAAY,CAAC,CAAD,C,UAGZC,IAAI,CAAC,CAACK,cAAD,CAAD,C,UAEJN,YAAY,CAAC,CAAD,C;;;;;;;;;;;;;;;;gBAGNmD,G,GAAW,IAAInB,GAAJ,E;gBACXoB,O,GAAmB,IAAInB,OAAJ,E;gBACnBoB,M,GAAiB,IAAInB,MAAJ,E;gBACjBoB,O,GAAmB,IAAInB,OAAJ,E;gBAMnBoB,a,GAAiC,E;gBACjCC,a,GAAiC,E;gBACjCC,oB,GAAgD,IAAIC,GAAJ,E;gBAC7CC,M,GAAS,K;gBACTC,a,GAAgB,G;gBAChBC,Q,GAAmB,MAAM,M;gBACzBC,a,GAAgB,IAAIJ,GAAJ,E;gBAChBK,U,GAAa,IAAIC,YAAJ,CAAiBxD,SAAS,CAACyD,KAA3B,C;gBACbC,U,GAAa,IAAIF,YAAJ,CAAiBtD,SAAS,CAACuD,KAA3B,C;gBACbE,U,GAAa,IAAIH,YAAJ,CAAiBvD,SAAS,CAACwD,KAA3B,C;;;;;;eAEhBG,U,GAAP,oBAAmBC,IAAnB,EAAuD;AACnD,oCAAMD,UAAN,YAAiBC,IAAjB;;AAEA,cAAI,KAAKC,MAAL,CAAYC,MAAZ,KAAuB,CAA3B,EAA8B;AAC1B,gBAAMC,UAAU,GAAG,IAAIjE,UAAJ,EAAnB;AACAiE,YAAAA,UAAU,CAACJ,UAAX,CAAsB7D,UAAU,CAACkE,QAAjC;;AACA,iBAAKH,MAAL,CAAYI,IAAZ,CAAiBF,UAAjB;;AAEA,gBAAMG,WAAW,GAAG,IAAIvE,WAAJ,EAApB;AACAuE,YAAAA,WAAW,CAACP,UAAZ,CAAuBhE,WAAW,CAACqE,QAAnC;;AACA,iBAAKH,MAAL,CAAYI,IAAZ,CAAiBC,WAAjB;AACH;;AAED,iBAAO,IAAP;AACH,S;;eAEMC,Q,GAAP,oBAA4B;AACxB,eAAKC,OAAL,GAAe,EAAf;;AAEA,cAAI,2BAAOD,QAAP,WAAJ,EAAuB;AACnB,mBAAO,KAAP;AACH;;AAED,cAAI,CAAC,KAAKE,eAAL,EAAL,EAA6B;AACzBpC,YAAAA,OAAO,CAAC,IAAD,CAAP;AACA,mBAAO,KAAP;AACH;;AAED,iBAAO,IAAP;AACH,S;;eAEMqC,M,GAAP,gBAAeC,OAAf,EAAkC;AAC9B,eAAKC,eAAL,CAAqB,CAArB,EAAwBC,KAAxB;;AACA,eAAKC,eAAL;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,OAAO,CAACT,MAA5B,EAAoCa,CAAC,EAArC,EAAyC;AACrC,gBAAMC,MAAM,GAAGL,OAAO,CAACI,CAAD,CAAtB;;AACA,gBAAIC,MAAM,CAACC,KAAX,EAAkB;AACd,mBAAKC,eAAL,CAAqBF,MAArB;;AACA,mBAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlB,MAAL,CAAYC,MAAhC,EAAwCiB,CAAC,EAAzC,EAA6C;AACzC,qBAAKlB,MAAL,CAAYkB,CAAZ,EAAeT,MAAf,CAAsBM,MAAtB;AACH;AACJ;AACJ;;AACD,eAAKJ,eAAL,CAAqB,CAArB,EAAwBQ,GAAxB;;AACA,eAAKC,OAAL,CAAaC,KAAb,CAAmBC,MAAnB,CAA0B,KAAKX,eAA/B;AACH,S;;eAEMY,a,GAAP,uBAAsBC,UAAtB,EAAyD;AACrD,cAAIC,UAAU,GAAG,KAAKjC,aAAL,CAAmBkC,GAAnB,CAAuBF,UAAvB,CAAjB;;AACA,cAAIC,UAAJ,EAAgB;AAAE,mBAAOA,UAAP;AAAoB;;AAEtC,cAAME,MAAM,GAAG,KAAKA,MAApB;AACA,cAAMC,eAAe,GAAG,IAAI/E,eAAJ,EAAxB;AACA,cAAMgF,sBAAsB,GAAG,IAAI/E,sBAAJ,EAA/B;AACA8E,UAAAA,eAAe,CAACE,MAAhB,GAAyBH,MAAM,CAACI,WAAhC;AACAF,UAAAA,sBAAsB,CAACC,MAAvB,GAAgCH,MAAM,CAACK,kBAAvC;AACAH,UAAAA,sBAAsB,CAACI,cAAvB,GAAwCrF,OAAO,CAACsF,OAAhD;AACAL,UAAAA,sBAAsB,CAACM,YAAvB,GAAsCvF,OAAO,CAACsF,OAA9C;;AAEA,cAAI,EAAEV,UAAU,GAAG/E,SAAS,CAAC2F,KAAzB,CAAJ,EAAqC;AACjC,gBAAIZ,UAAU,GAAGpE,WAAjB,EAA8B;AAC1BwE,cAAAA,eAAe,CAACS,MAAhB,GAAyBtF,MAAM,CAACmF,OAAhC;AACH,aAFD,MAEO;AACHN,cAAAA,eAAe,CAACS,MAAhB,GAAyBtF,MAAM,CAACuF,IAAhC;AACAV,cAAAA,eAAe,CAACW,WAAhB,GAA8BvF,aAAa,CAACwF,WAA5C;AACH;AACJ;;AAED,cAAI,CAAChB,UAAU,GAAG/E,SAAS,CAACgG,aAAxB,MAA2ChG,SAAS,CAACgG,aAAzD,EAAwE;AACpE,gBAAI,EAAEjB,UAAU,GAAG/E,SAAS,CAACiG,KAAzB,CAAJ,EAAqCb,sBAAsB,CAACc,WAAvB,GAAqC5F,MAAM,CAACuF,IAA5C;AACrC,gBAAI,EAAEd,UAAU,GAAG/E,SAAS,CAACmG,OAAzB,CAAJ,EAAuCf,sBAAsB,CAACgB,aAAvB,GAAuC9F,MAAM,CAACuF,IAA9C;AACvCT,YAAAA,sBAAsB,CAACU,WAAvB,GAAqCvF,aAAa,CAAC8F,gCAAnD;AACH;;AAED,cAAMC,cAAc,GAAG,IAAI9F,cAAJ,CAAmB,CAAC2E,eAAD,CAAnB,EAAsCC,sBAAtC,CAAvB;AACAJ,UAAAA,UAAU,GAAGE,MAAM,CAACqB,gBAAP,CAAwBD,cAAxB,CAAb;;AACA,eAAKvD,aAAL,CAAmByD,GAAnB,CAAuBzB,UAAvB,EAAmCC,UAAnC;;AAEA,iBAAOA,UAAP;AACH;AAED;AACJ;AACA;AACA;;;eACWZ,e,GAAP,2BAA0B;AACtB,eAAKqC,cAAL,CAAoBC,MAApB;;AACA,cAAMC,IAAI,GAAG/F,QAAQ,CAACgG,QAAT,CAAkBD,IAA/B;AACA,cAAME,EAAE,GAAG,KAAK7D,UAAhB;AACA,cAAMkC,MAAM,GAAG,KAAKA,MAApB;AAEA,cAAM4B,YAAY,GAAGC,IAAI,CAACC,KAAL,CAAW9B,MAAM,CAAC+B,KAAlB,CAArB;AACA,cAAMC,aAAa,GAAGH,IAAI,CAACC,KAAL,CAAW9B,MAAM,CAACiC,MAAlB,CAAtB,CAPsB,CAStB;;AACAN,UAAAA,EAAE,CAACpH,SAAS,CAAC2H,WAAX,CAAF,GAA4BT,IAAI,CAACU,cAAjC;AACAR,UAAAA,EAAE,CAACpH,SAAS,CAAC2H,WAAV,GAAwB,CAAzB,CAAF,GAAgCT,IAAI,CAACW,SAArC;AACAT,UAAAA,EAAE,CAACpH,SAAS,CAAC2H,WAAV,GAAwB,CAAzB,CAAF,GAAgCxG,QAAQ,CAACgG,QAAT,CAAkBW,cAAlB,EAAhC;AAEAV,UAAAA,EAAE,CAACpH,SAAS,CAAC+H,kBAAX,CAAF,GAAmCtC,MAAM,CAAC+B,KAA1C;AACAJ,UAAAA,EAAE,CAACpH,SAAS,CAAC+H,kBAAV,GAA+B,CAAhC,CAAF,GAAuCtC,MAAM,CAACiC,MAA9C;AACAN,UAAAA,EAAE,CAACpH,SAAS,CAAC+H,kBAAV,GAA+B,CAAhC,CAAF,GAAuC,MAAMtC,MAAM,CAAC+B,KAApD;AACAJ,UAAAA,EAAE,CAACpH,SAAS,CAAC+H,kBAAV,GAA+B,CAAhC,CAAF,GAAuC,MAAMtC,MAAM,CAACiC,MAApD;AAEAN,UAAAA,EAAE,CAACpH,SAAS,CAACgI,kBAAX,CAAF,GAAmCX,YAAnC;AACAD,UAAAA,EAAE,CAACpH,SAAS,CAACgI,kBAAV,GAA+B,CAAhC,CAAF,GAAuCP,aAAvC;AACAL,UAAAA,EAAE,CAACpH,SAAS,CAACgI,kBAAV,GAA+B,CAAhC,CAAF,GAAuC,MAAMZ,EAAE,CAACpH,SAAS,CAACgI,kBAAX,CAA/C;AACAZ,UAAAA,EAAE,CAACpH,SAAS,CAACgI,kBAAV,GAA+B,CAAhC,CAAF,GAAuC,MAAMZ,EAAE,CAACpH,SAAS,CAACgI,kBAAV,GAA+B,CAAhC,CAA/C;;AAEA,eAAKvD,eAAL,CAAqB,CAArB,EAAwBwD,YAAxB,CAAqC,KAAKjB,cAAL,CAAoBkB,SAApB,CAA8BlI,SAAS,CAACmI,OAAxC,CAArC,EAAuF,KAAK5E,UAA5F;AACH,S;;eAEOe,e,GAAR,2BAA2B;AACvB,cAAMmB,MAAM,GAAG,KAAKA,MAApB;;AAEA,eAAKhB,eAAL,CAAqBP,IAArB,CAA0BuB,MAAM,CAAC2C,aAAjC;;AAEA,cAAMC,SAAS,GAAG5C,MAAM,CAAC6C,YAAP,CAAoB,IAAItH,UAAJ,CAClCX,cAAc,CAACkI,OAAf,GAAyBlI,cAAc,CAACmI,YADN,EAElClI,cAAc,CAACmI,IAAf,GAAsBnI,cAAc,CAACoI,MAFH,EAGlC1I,SAAS,CAAC2I,IAHwB,EAIlC3I,SAAS,CAAC2I,IAJwB,CAApB,CAAlB;;AAMA,eAAK3B,cAAL,CAAoB4B,UAApB,CAA+B5I,SAAS,CAACmI,OAAzC,EAAkDE,SAAlD;;AAEA,cAAMQ,SAAS,GAAGpD,MAAM,CAAC6C,YAAP,CAAoB,IAAItH,UAAJ,CAClCX,cAAc,CAACkI,OAAf,GAAyBlI,cAAc,CAACmI,YADN,EAElClI,cAAc,CAACmI,IAAf,GAAsBnI,cAAc,CAACoI,MAFH,EAGlCxI,SAAS,CAACyI,IAHwB,EAIlCzI,SAAS,CAACyI,IAJwB,CAApB,CAAlB;;AAMA,eAAK3B,cAAL,CAAoB4B,UAApB,CAA+B1I,SAAS,CAACiI,OAAzC,EAAkDU,SAAlD;;AAEA,cAAMC,SAAS,GAAGrD,MAAM,CAAC6C,YAAP,CAAoB,IAAItH,UAAJ,CAClCX,cAAc,CAACkI,OAAf,GAAyBlI,cAAc,CAACmI,YADN,EAElClI,cAAc,CAACmI,IAAf,GAAsBnI,cAAc,CAACoI,MAFH,EAGlCzI,SAAS,CAAC0I,IAHwB,EAIlC1I,SAAS,CAAC0I,IAJwB,CAApB,CAAlB;;AAMA,eAAK3B,cAAL,CAAoB4B,UAApB,CAA+B3I,SAAS,CAACkI,OAAzC,EAAkDW,SAAlD;;AAEA,cAAMC,oBAAoB,GAAGhH,cAAc,CAACO,YAAD,CAA3C;AACA,cAAM0G,gBAAgB,GAAGhH,UAAU,CAACiH,UAAX,CAAsBxD,MAAtB,EAA8BsD,oBAA9B,CAAzB;;AACA,eAAK/B,cAAL,CAAoBkC,WAApB,CAAgC/I,yBAAhC,EAA2D6I,gBAA3D;;AACA,eAAKhC,cAAL,CAAoBmC,WAApB,CAAgChJ,yBAAhC,EAA2D8B,aAAa,CAACuD,GAAd,CAA6B,iBAA7B,EAAgD4D,aAAhD,EAA3D;;AACA,eAAKpC,cAAL,CAAoBkC,WAApB,CAAgC9I,yCAAhC,EAA2E4I,gBAA3E;;AACA,eAAKhC,cAAL,CAAoBmC,WAApB,CAAgC/I,yCAAhC,EAA2E6B,aAAa,CAACuD,GAAd,CAA6B,iBAA7B,EAAgD4D,aAAhD,EAA3E;;AACA,eAAKpC,cAAL,CAAoBC,MAApB,GAnCuB,CAqCvB;;;AACA,eAAKoC,MAAL,CAAYC,UAAZ,GAAyB,KAAKnG,MAA9B;AACA,eAAKkG,MAAL,CAAYE,wBAAZ,GAAuC,KAAK9D,MAAL,CAAY+D,UAAZ,CAAuBvI,OAAO,CAACwI,aAA/B,CAAvC;AAEA,iBAAO,IAAP;AACH,S;;eAEMC,e,GAAP,yBAAwB7E,MAAxB,EAAwC;AACpC,eAAKmC,cAAL,CAAoBC,MAApB;;AACA,cAAM0C,SAAS,GAAG9E,MAAM,CAACC,KAAP,CAAc6E,SAAhC;AACA,cAAMlE,MAAM,GAAG,KAAKA,MAApB;AACA,cAAMmE,UAAU,GAAG,KAAK9G,OAAxB;;AAEA,cAAI8G,UAAU,CAACC,OAAf,EAAwB;AACpB,gBAAIF,SAAS,IAAIC,UAAU,CAACnK,IAAX,KAAoBmC,UAAU,CAACkI,SAAhD,EAA2D;AACvD,kBAAI,KAAK7G,oBAAL,CAA0B8G,GAA1B,CAA8BJ,SAA9B,CAAJ,EAA8C;AAC1C,qBAAK3C,cAAL,CAAoBmC,WAApB,CAAgChJ,yBAAhC,EAA2D,KAAK8C,oBAAL,CAA0BuC,GAA1B,CAA8BmE,SAA9B,EAA0CK,aAA1C,CAAwD,CAAxD,CAA3D;AACH,eAHsD,CAKvD;;;AACA,kBAAIC,gBAAJ,CANuD,CAQvD;;AACA,kBAAIC,CAAC,GAAG,CAAR;AACA,kBAAIC,CAAC,GAAG,CAAR;AACA,kBAAIC,GAAG,GAAG,CAAV;;AACA,kBAAIR,UAAU,CAACS,SAAf,EAA0B;AACtBJ,gBAAAA,gBAAgB,GAAGpI,oBAAoB,CAAC,IAAD,EAAO8H,SAAS,CAACW,IAAV,CAAgBC,gBAAhB,EAAP,EAA4CZ,SAAS,CAACa,SAAtD,EAAiEnI,WAAjE,CAAvC,CADsB,CAEtB;;AACA,oBAAMoI,MAAM,GAAGb,UAAU,CAACc,MAAX,CAAkBD,MAAjC;AACAP,gBAAAA,CAAC,GAAGO,MAAM,GAAGb,UAAU,CAACe,MAAxB;AACAR,gBAAAA,CAAC,GAAGM,MAAJ;AAEA,oBAAMG,OAAO,GAAGtJ,IAAI,CAACuJ,QAAL,CAAcjB,UAAU,CAACc,MAAX,CAAkBI,MAAhC,EAAwCzI,WAAxC,CAAhB;AACA+H,gBAAAA,GAAG,GAAI9C,IAAI,CAACyD,GAAL,CAASH,OAAO,GAAGjJ,OAAO,CAACqJ,wBAA3B,EAAqDrJ,OAAO,CAACsJ,OAA7D,CAAP;AACH,eATD,MASO;AACHhB,gBAAAA,gBAAgB,GAAGN,SAAS,CAACW,IAAV,CAAgBY,cAAhB,EAAnB;AAEAhB,gBAAAA,CAAC,GAAGN,UAAU,CAACuB,SAAX,GAAuBvB,UAAU,CAACe,MAAtC;AACAR,gBAAAA,CAAC,GAAGP,UAAU,CAACuB,SAAf;AAEAf,gBAAAA,GAAG,GAAGR,UAAU,CAACQ,GAAjB;AACH;;AAED/I,cAAAA,IAAI,CAAC+J,MAAL,CAAYjJ,aAAZ,EAA2B8H,gBAA3B;AAEA,kBAAMoB,eAAe,GAAG5F,MAAM,CAAC6F,gBAAP,GAA0B7F,MAAM,CAAC8F,YAAzD,CAhCuD,CAgCgB;;AACvElK,cAAAA,IAAI,CAACmK,KAAL,CAAWpJ,iBAAX,EAA8B,CAAC8H,CAA/B,EAAkCA,CAAlC,EAAqC,CAACC,CAAtC,EAAyCA,CAAzC,EAA4CP,UAAU,CAAC6B,IAAvD,EAA6DrB,GAA7D,EACI3E,MAAM,CAACiG,aADX,EAC0BL,eAD1B;AAEAhK,cAAAA,IAAI,CAACsK,QAAL,CAAcvJ,iBAAd,EAAiCA,iBAAjC,EAAoDD,aAApD;AACAd,cAAAA,IAAI,CAACuK,OAAL,CAAa,KAAKjI,UAAlB,EAA8BvB,iBAA9B,EAAiDnC,SAAS,CAAC4L,0BAA3D;AAEA,mBAAKlI,UAAL,CAAgB1D,SAAS,CAAC6L,kBAA1B,IAAoDlC,UAAU,CAACmC,IAAX,CAAgB7B,CAApE;AACA,mBAAKvG,UAAL,CAAgB1D,SAAS,CAAC6L,kBAAV,GAA+B,CAA/C,IAAoDlC,UAAU,CAACmC,IAAX,CAAgB5B,CAApE;AACA,mBAAKxG,UAAL,CAAgB1D,SAAS,CAAC6L,kBAAV,GAA+B,CAA/C,IAAoDlC,UAAU,CAACoC,GAA/D;AACA,mBAAKrI,UAAL,CAAgB1D,SAAS,CAAC6L,kBAAV,GAA+B,CAA/C,IAAoDlC,UAAU,CAACqC,IAA/D;AACH,aA1CD,MA0CO,IAAItC,SAAS,IAAIC,UAAU,CAACnK,IAAX,KAAoBmC,UAAU,CAACsK,MAAhD,EAAwD;AAC3DpK,cAAAA,gBAAgB,CAAC8H,UAAD,EAAaD,SAAb,EAAwB,KAAKhG,UAA7B,CAAhB;AACH;;AAEDvC,YAAAA,KAAK,CAACwK,OAAN,CAAc,KAAKjI,UAAnB,EAA+BiG,UAAU,CAACuC,WAA1C,EAAuDlM,SAAS,CAACmM,mBAAjE;;AACA,iBAAK3H,eAAL,CAAqB,CAArB,EAAwBwD,YAAxB,CAAqC,KAAKjB,cAAL,CAAoBkB,SAApB,CAA8BjI,SAAS,CAACkI,OAAxC,CAArC,EAAuF,KAAKxE,UAA5F;AACH;AACJ,S;;eAEMoB,e,GAAP,yBAAwBF,MAAxB,EAAwC;AACpC,cAAMY,MAAM,GAAG,KAAKA,MAApB;AACA,cAAMX,KAAK,GAAGD,MAAM,CAACC,KAAP,GAAeD,MAAM,CAACC,KAAtB,GAA8B3D,QAAQ,CAACgG,QAAT,CAAkBkF,QAAlB,GAA6BC,WAAzE;AACA,cAAM3C,SAAS,GAAG7E,KAAK,CAAC6E,SAAxB;AACA,cAAM/G,OAAO,GAAG,KAAKA,OAArB;AACA,cAAMD,GAAG,GAAG,KAAKA,GAAjB;AACA,cAAM0E,YAAY,GAAGC,IAAI,CAACC,KAAL,CAAW9B,MAAM,CAAC+B,KAAlB,CAArB;AACA,cAAMC,aAAa,GAAGH,IAAI,CAACC,KAAL,CAAW9B,MAAM,CAACiC,MAAlB,CAAtB,CAPoC,CAQpC;;AACA,cAAM6E,EAAE,GAAG,KAAK7I,UAAhB;AACA,cAAM8I,QAAQ,GAAG3H,MAAM,CAAC2H,QAAxB;AAEAD,UAAAA,EAAE,CAACrM,SAAS,CAACuM,mBAAX,CAAF,GAAoC5H,MAAM,CAAC2C,KAAP,GAAeH,YAAf,GAA8B,KAAKqF,YAAvE;AACAH,UAAAA,EAAE,CAACrM,SAAS,CAACuM,mBAAV,GAAgC,CAAjC,CAAF,GAAwC5H,MAAM,CAAC6C,MAAP,GAAgBD,aAAhB,GAAgC,KAAKiF,YAA7E;AACAH,UAAAA,EAAE,CAACrM,SAAS,CAACuM,mBAAV,GAAgC,CAAjC,CAAF,GAAwC,MAAMF,EAAE,CAACrM,SAAS,CAACuM,mBAAX,CAAhD;AACAF,UAAAA,EAAE,CAACrM,SAAS,CAACuM,mBAAV,GAAgC,CAAjC,CAAF,GAAwC,MAAMF,EAAE,CAACrM,SAAS,CAACuM,mBAAV,GAAgC,CAAjC,CAAhD;AAEAF,UAAAA,EAAE,CAACrM,SAAS,CAACyM,eAAX,CAAF,GAAgCH,QAAhC;AACAD,UAAAA,EAAE,CAACrM,SAAS,CAACyM,eAAV,GAA4B,CAA7B,CAAF,GAAoC,MAAMH,QAA1C;AACAD,UAAAA,EAAE,CAACrM,SAAS,CAACyM,eAAV,GAA4B,CAA7B,CAAF,GAAoC,KAAKxJ,MAAL,GAAc,GAAd,GAAoB,GAAxD;AACAoJ,UAAAA,EAAE,CAACrM,SAAS,CAACyM,eAAV,GAA4B,CAA7B,CAAF,GAAoC,KAAKtJ,QAAL,GAAgBmJ,QAApD;;AAEA,cAAI7C,SAAJ,EAAe;AACXrI,YAAAA,IAAI,CAACsK,OAAL,CAAaW,EAAb,EAAiB5C,SAAS,CAACa,SAA3B,EAAsCtK,SAAS,CAAC0M,mBAAhD;AACAtL,YAAAA,IAAI,CAACsK,OAAL,CAAaW,EAAb,EAAiB5C,SAAS,CAACkD,KAA3B,EAAkC3M,SAAS,CAAC4M,qBAA5C;;AACA,gBAAInD,SAAS,CAACoD,mBAAd,EAAmC;AAC/B,kBAAMC,YAAY,GAAGrD,SAAS,CAACsD,mBAA/B;AACAV,cAAAA,EAAE,CAACrM,SAAS,CAAC4M,qBAAX,CAAF,IAAuCE,YAAY,CAAC9C,CAApD;AACAqC,cAAAA,EAAE,CAACrM,SAAS,CAAC4M,qBAAV,GAAkC,CAAnC,CAAF,IAA2CE,YAAY,CAAC7C,CAAxD;AACAoC,cAAAA,EAAE,CAACrM,SAAS,CAAC4M,qBAAV,GAAkC,CAAnC,CAAF,IAA2CE,YAAY,CAACE,CAAxD;AACH;;AAED,gBAAI,KAAK/J,MAAT,EAAiB;AACboJ,cAAAA,EAAE,CAACrM,SAAS,CAAC4M,qBAAV,GAAkC,CAAnC,CAAF,GAA0CnD,SAAS,CAACwD,WAAV,GAAwB,KAAK9J,QAAvE;AACH,aAFD,MAEO;AACHkJ,cAAAA,EAAE,CAACrM,SAAS,CAAC4M,qBAAV,GAAkC,CAAnC,CAAF,GAA0CnD,SAAS,CAACwD,WAAV,GAAwBX,QAAlE;AACH;AACJ,WAfD,MAeO;AACHlL,YAAAA,IAAI,CAACsK,OAAL,CAAaW,EAAb,EAAiBjL,IAAI,CAAC8L,MAAtB,EAA8BlN,SAAS,CAAC0M,mBAAxC;AACArL,YAAAA,IAAI,CAACqK,OAAL,CAAaW,EAAb,EAAiBhL,IAAI,CAAC8L,IAAtB,EAA4BnN,SAAS,CAAC4M,qBAAtC;AACH;;AAED,cAAMQ,QAAQ,GAAG1K,OAAO,CAAC2K,UAAzB;;AACA,cAAI,KAAKpK,MAAT,EAAiB;AACbmK,YAAAA,QAAQ,CAAC,CAAD,CAAR,GAAc1K,OAAO,CAAC4K,QAAR,GAAmB,KAAKnK,QAAtC;AACH,WAFD,MAEO;AACHiK,YAAAA,QAAQ,CAAC,CAAD,CAAR,GAAc1K,OAAO,CAAC4K,QAAR,GAAmBhB,QAAjC;AACH;;AACDD,UAAAA,EAAE,CAACxF,GAAH,CAAOuG,QAAP,EAAiBpN,SAAS,CAACuN,kBAA3B;AACAlB,UAAAA,EAAE,CAACxF,GAAH,CAAOnE,OAAO,CAAC8K,WAAf,EAA4BxN,SAAS,CAACyN,qBAAtC;AAEAtM,UAAAA,IAAI,CAACuK,OAAL,CAAaW,EAAb,EAAiB1H,MAAM,CAAC+I,OAAxB,EAAiC1N,SAAS,CAAC2N,eAA3C;AACAxM,UAAAA,IAAI,CAACuK,OAAL,CAAaW,EAAb,EAAiB1H,MAAM,CAACyF,IAAP,CAAYwD,WAA7B,EAA0C5N,SAAS,CAAC6N,mBAApD;AACA1M,UAAAA,IAAI,CAACuK,OAAL,CAAaW,EAAb,EAAiB1H,MAAM,CAACmJ,OAAxB,EAAiC9N,SAAS,CAAC+N,eAA3C;AACA5M,UAAAA,IAAI,CAACuK,OAAL,CAAaW,EAAb,EAAiB1H,MAAM,CAACqJ,UAAxB,EAAoChO,SAAS,CAACiO,mBAA9C;AACA9M,UAAAA,IAAI,CAACuK,OAAL,CAAaW,EAAb,EAAiB1H,MAAM,CAACuJ,WAAxB,EAAqClO,SAAS,CAACmO,oBAA/C;AACAhN,UAAAA,IAAI,CAACuK,OAAL,CAAaW,EAAb,EAAiB1H,MAAM,CAACyJ,cAAxB,EAAwCpO,SAAS,CAACqO,wBAAlD;AACAjN,UAAAA,IAAI,CAACsK,OAAL,CAAaW,EAAb,EAAiB1H,MAAM,CAAC2J,QAAxB,EAAkCtO,SAAS,CAACuO,iBAA5C;AACA,cAAIpD,eAAe,GAAG5F,MAAM,CAAC6F,gBAA7B;;AACA,cAAIzG,MAAM,CAAC6J,MAAP,CAAeC,uBAAnB,EAA4C;AACxCtD,YAAAA,eAAe,IAAI5F,MAAM,CAAC8F,YAA1B,CADwC,CACA;AAC3C;;AACDgB,UAAAA,EAAE,CAACrM,SAAS,CAACuO,iBAAV,GAA8B,CAA/B,CAAF,GAAsCpD,eAAtC;;AAEA,cAAI1I,GAAG,CAACkH,OAAR,EAAiB;AACb0C,YAAAA,EAAE,CAACxF,GAAH,CAAOpE,GAAG,CAAC4K,UAAX,EAAuBrN,SAAS,CAAC0O,uBAAjC;AAEArC,YAAAA,EAAE,CAACrM,SAAS,CAAC2O,sBAAX,CAAF,GAAuClM,GAAG,CAACmM,QAA3C;AACAvC,YAAAA,EAAE,CAACrM,SAAS,CAAC2O,sBAAV,GAAmC,CAApC,CAAF,GAA2ClM,GAAG,CAACoM,MAA/C;AACAxC,YAAAA,EAAE,CAACrM,SAAS,CAAC2O,sBAAV,GAAmC,CAApC,CAAF,GAA2ClM,GAAG,CAACqM,UAA/C;AAEAzC,YAAAA,EAAE,CAACrM,SAAS,CAAC+O,qBAAX,CAAF,GAAsCtM,GAAG,CAACuM,MAA1C;AACA3C,YAAAA,EAAE,CAACrM,SAAS,CAAC+O,qBAAV,GAAkC,CAAnC,CAAF,GAA0CtM,GAAG,CAACwM,QAA9C;AACA5C,YAAAA,EAAE,CAACrM,SAAS,CAAC+O,qBAAV,GAAkC,CAAnC,CAAF,GAA0CtM,GAAG,CAACyM,QAA9C;AACH;;AAED,eAAK3K,eAAL,CAAqB,CAArB,EAAwBwD,YAAxB,CAAqC,KAAKjB,cAAL,CAAoBkB,SAApB,CAA8BhI,SAAS,CAACiI,OAAxC,CAArC,EAAuF,KAAKzE,UAA5F;AACH,S;;eAEO2L,W,GAAR,uBAAuB;AACnB,cAAI,KAAKrI,cAAT,EAAyB;AACrB,iBAAKA,cAAL,CAAoBkB,SAApB,CAA8BlI,SAAS,CAACmI,OAAxC,EAAiDmH,OAAjD;;AACA,iBAAKtI,cAAL,CAAoBkB,SAApB,CAA8BjI,SAAS,CAACkI,OAAxC,EAAiDmH,OAAjD;;AACA,iBAAKtI,cAAL,CAAoBkB,SAApB,CAA8BhI,SAAS,CAACiI,OAAxC,EAAiDmH,OAAjD;;AACA,iBAAKtI,cAAL,CAAoBiC,UAApB,CAA+B9I,yBAA/B,EAA0DmP,OAA1D;;AACA,iBAAKtI,cAAL,CAAoBiC,UAApB,CAA+B7I,yCAA/B,EAA0EkP,OAA1E;;AACA,iBAAKtI,cAAL,CAAoBuI,UAApB,CAA+BpP,yBAA/B,EAA0DmP,OAA1D;;AACA,iBAAKtI,cAAL,CAAoBuI,UAApB,CAA+BnP,yCAA/B,EAA0EkP,OAA1E;AACH;AACJ,S;;eAEMA,O,GAAP,mBAAkB;AACd,eAAKD,WAAL;;AAEA,cAAMG,MAAM,GAAG,KAAKlM,aAAL,CAAmBmM,MAAnB,EAAf;;AACA,cAAIC,KAAK,GAAGF,MAAM,CAACG,IAAP,EAAZ;;AACA,iBAAO,CAACD,KAAK,CAACE,IAAd,EAAoB;AAChBF,YAAAA,KAAK,CAACG,KAAN,CAAYP,OAAZ;AACAI,YAAAA,KAAK,GAAGF,MAAM,CAACG,IAAP,EAAR;AACH;;AAED,eAAKlL,eAAL,CAAqBV,MAArB,GAA8B,CAA9B;AAEA,eAAKnB,OAAL,CAAa0M,OAAb;AACA,eAAKzM,MAAL,CAAYyM,OAAZ;AACA,eAAK3M,GAAL,CAAS2M,OAAT;AACA,eAAKxM,OAAL,CAAawM,OAAb;AAEA,2CAAaA,OAAb;AACH,S;;;;8BA/XY;AACT,mBAAO,KAAKnM,MAAZ;AACH,W;4BAEU2M,G,EAAK;AACZ,gBAAI,KAAK3M,MAAL,KAAgB2M,GAApB,EAAyB;AACrB;AACH;;AAED,iBAAK3M,MAAL,GAAc2M,GAAd;AACA,gBAAMC,oBAAoB,GAAG,KAAKrM,UAAlC;AACAqM,YAAAA,oBAAoB,CAAC7P,SAAS,CAACyM,eAAV,GAA4B,CAA7B,CAApB,GAAsD,KAAKxJ,MAAL,GAAc,GAAd,GAAoB,GAA1E;AACH;;;8BAE2B;AACxB,mBAAO,KAAKC,aAAZ;AACH;;;8BAEsB;AACnB,mBAAO,KAAKC,QAAZ;AACH;AAED;AACJ;AACA;AACA;;;;8BACmC;AAC3B,mBAAO,KAAKM,UAAZ;AACH;;;;QA7BgChE,c,iGAgChCD,Y;;;;;iBAEiD,E;;2FAGjDA,Y;;;;;iBAEuC,E"}