{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/spot-light.ts"],"names":["AABB","Frustum","Mat4","Quat","Vec3","Light","LightType","nt2lm","AABBPool","AABBView","FrustumPool","LightPool","LightView","NULL_HANDLE","recordFrustumToSharedMemory","_forward","_qt","_matView","_matProj","_matViewProj","_matViewProjInv","SpotLight","_pos","size","set","_handle","SIZE","get","range","_range","RANGE","_needUpdate","lum","ILLUMINANCE","_dir","SPOT_ANGLE","val","_angle","Math","cos","ASPECT","_aabb","_frustum","_spotAngle","PI","_hAABB","_hFrustum","create","initialize","alloc","TYPE","SPOT","setVec3","DIRECTION","update","_node","hasChangedFlags","getWorldPosition","transformQuat","getWorldRotation","normalize","x","y","z","getWorldRT","invert","perspective","multiply","POSITION","CENTER","center","HALF_EXTENSION","halfExtents","destroy","free"],"mappings":"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"}