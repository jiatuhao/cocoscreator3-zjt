{"version":3,"sources":["file:///Applications/CocosCreator/Creator/3.0.0/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/forward/planar-shadow-queue.ts"],"names":["_ab","AABB","PlanarShadowQueue","constructor","pipeline","_pendingModels","_instancedQueue","RenderInstancedQueue","_pipeline","gatherShadowPasses","camera","cmdBuff","shadows","length","enabled","type","ShadowType","Planar","updateShadowUBO","scene","frstm","frustum","shadowVisible","visibility","Layers","BitMask","DEFAULT","mainLight","models","renderObjects","instancedBuffer","InstancedBuffer","get","instancingMaterial","passes","clear","queue","add","i","model","node","castShadow","worldBounds","transform","matLight","intersect","aabbFrustum","isInstancingEnabled","j","subModels","merge","instancedAttributes","push","uploadBuffers","recordCommandBuffer","device","renderPass","pass","material","descriptorSet","DSPool","PassPool","handle","PassView","DESCRIPTOR_SET","bindDescriptorSet","SetIndex","MATERIAL","modelCount","subModel","shader","ShaderPool","planarShaderHandel","ia","inputAssembler","pso","PipelineStateManager","getOrCreatePipelineState","bindPipelineState","LOCAL","bindInputAssembler","draw"],"mappings":"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"}