{"version":3,"sources":["file:///Applications/CocosCreator/Creator/3.0.0/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/spot-light.ts"],"names":["_forward","Vec3","_qt","Quat","_matView","Mat4","_matProj","_matViewProj","_matViewProjInv","SpotLight","Light","position","_pos","size","LightPool","set","_handle","LightView","SIZE","get","range","_range","RANGE","_needUpdate","luminance","lum","ILLUMINANCE","direction","_dir","spotAngle","SPOT_ANGLE","val","_angle","Math","cos","aspect","ASPECT","aabb","_aabb","frustum","_frustum","constructor","_spotAngle","PI","_hAABB","NULL_HANDLE","_hFrustum","AABB","create","Frustum","initialize","AABBPool","alloc","FrustumPool","TYPE","LightType","SPOT","setVec3","DIRECTION","update","_node","hasChangedFlags","getWorldPosition","transformQuat","getWorldRotation","normalize","x","y","z","getWorldRT","invert","perspective","multiply","POSITION","AABBView","CENTER","center","HALF_EXTENSION","halfExtents","destroy","free"],"mappings":"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"}