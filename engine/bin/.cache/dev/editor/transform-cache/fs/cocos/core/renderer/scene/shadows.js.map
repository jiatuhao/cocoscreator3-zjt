{"version":3,"sources":["file:///Applications/CocosCreator/Creator/3.0.0/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/shadows.ts"],"names":["multiPatches","name","value","ShadowType","Planar","ShadowMap","PCFType","HARD","FILTER_X5","FILTER_X9","FILTER_X25","SHADOW_TYPE_NONE","Shadows","enabled","ShadowsPool","get","_handle","ShadowsView","ENABLE","val","set","TYPE","activate","normal","_normal","Vec3","copy","setVec3","NORMAL","distance","DISTANCE","shadowColor","_shadowColor","color","setVec4","COLOR","type","near","NEAR","far","FAR","aspect","ASPECT","orthoSize","ORTHO_SIZE","size","_size","setVec2","SIZE","pcf","PCF_TYPE","shadowMapDirty","SHADOW_MAP_DIRTY","bias","BIAS","autoAdapt","AUTO_ADAPT","matLight","_matLight","material","_material","instancingMaterial","_instancingMaterial","handle","constructor","sphere","Sphere","maxReceived","Color","Mat4","Vec2","NULL_HANDLE","alloc","getPlanarShader","patches","Material","initialize","effectName","PLANAR_PASS","passes","getShaderVariant","shadowsInfo","shadowMapSize","_updatePipeline","_updatePlanarInfo","root","legacyCC","director","pipeline","macros","CC_RECEIVE_SHADOW","onGlobalPipelineStateChanged","defines","USE_INSTANCING","INSTANCE_PASS","destroy","free","MAX_FAR","COEFFICIENT_OF_EXPANSION","Math","sqrt"],"mappings":"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"}