{"version":3,"sources":["file:///Applications/CocosCreator/Creator/3.0.0/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/downloader.ts"],"names":["REGEX","downloadImage","url","options","onComplete","func","sys","capabilities","imageBitmap","legacyCC","assetManager","allowImageBitmap","downloadBlob","downloadDomImage","xhrResponseType","onFileProgress","downloadJson","downloadArrayBuffer","downloadText","downloadBundle","nameOrUrl","bundleName","test","downloader","remoteBundles","indexOf","remoteServerAddress","version","bundleVers","count","config","out","error","err","response","base","jspath","importBundleEntry","then","catch","e","Downloader","maxConcurrency","maxRequestsPerFrame","maxRetryCount","EDITOR","appendTimeStamp","limited","retryInterval","downloadDomAudio","downloadFile","downloadScript","_downloaders","bundle","default","_downloading","Cache","_queue","_queueDirty","_totalNum","_totalNumThisPeriod","_lastDate","_checkNextPeriod","_remoteServerAddress","_maxInterval","init","clear","length","register","type","handler","js","mixin","download","id","file","files","get","downloadCallbacks","push","request","find","x","priority","process","index","callback","add","_updateTime","done","data","_handleQueueInNextFrame","finale","result","callbacks","remove","i","l","loadSubpackage","name","completeCallback","loadBundle","now","Date","deltaTime","director","getDeltaTime","interval","_handleQueue","sort","a","b","pop","bind"],"mappings":"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"}