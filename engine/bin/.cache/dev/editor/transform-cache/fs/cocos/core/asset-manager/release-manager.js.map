{"version":3,"sources":["file:///Applications/CocosCreator/Creator/3.0.0/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/release-manager.ts"],"names":["visitAsset","asset","deps","_uuid","push","visitComponent","comp","props","Object","getOwnPropertyNames","i","length","propName","value","Array","isArray","j","val","Asset","constructor","keys","visitNode","node","_components","_children","descendOpRef","refs","exclude","op","depends","dependUtil","getDeps","l","dependAsset","assets","get","uuid","refCount","includes","_temp","checkCircularReference","create","ReleaseManager","_persistNodeDeps","Cache","_toDelete","_eventListener","init","clear","_addPersistNodeRef","addRef","add","_removePersistNodeRef","has","decRef","remove","_autoRelease","oldScene","newScene","persistNodes","childs","TEST","autoReleaseAssets","dependencies","_depends","persistDeps","sceneDeps","dep","tryRelease","force","_free","_freeAssets","bind","forEach","EDITOR","ImageAsset","TextureBase","destroy","references"],"mappings":"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"}