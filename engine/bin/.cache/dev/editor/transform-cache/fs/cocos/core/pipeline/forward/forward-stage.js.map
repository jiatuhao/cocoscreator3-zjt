{"version":3,"sources":["file:///Applications/CocosCreator/Creator/3.0.0/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/forward/forward-stage.ts"],"names":["colors","Color","ForwardStage","RenderQueueDesc","RenderStage","constructor","_renderQueues","_renderArea","Rect","_batchedQueue","_instancedQueue","_phaseID","_clearFlag","RenderBatchedQueue","RenderInstancedQueue","_uiPhase","UIPhase","initialize","info","renderQueues","activate","pipeline","flow","i","length","phase","j","stages","sortFunc","opaqueCompareFn","sortMode","RenderQueueSortMode","BACK_TO_FRONT","transparentCompareFn","FRONT_TO_BACK","RenderQueue","isTransparent","phases","_additiveLightQueue","RenderAdditiveLightQueue","_pipeline","_planarQueue","PlanarShadowQueue","destroy","render","camera","clear","device","forEach","renderQueueClearFunc","renderObjects","m","p","k","ro","subModels","model","subModel","passes","pass","batchingScheme","BatchingSchemes","INSTANCING","instancedBuffer","InstancedBuffer","get","merge","instancedAttributes","queue","add","VB_MERGING","batchedBuffer","BatchedBuffer","insertRenderPass","renderQueueSortFunc","cmdBuff","commandBuffers","uploadBuffers","gatherLightPasses","gatherShadowPasses","vp","viewport","w","window","hasOnScreenAttachments","surfaceTransform","height","width","h","x","y","shadingScale","clearFlag","ClearFlag","COLOR","isHDR","clearColor","scale","fpScale","exposure","z","framebuffer","renderPass","colorTextures","getRenderPass","beginRenderPass","clearDepth","clearStencil","bindDescriptorSet","SetIndex","GLOBAL","descriptorSet","recordCommandBuffer","endRenderPass","rq","sort","initInfo","name","priority","ForwardStagePriority","FORWARD","tag","serializable"],"mappings":"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"}