{"version":3,"sources":["file:///Applications/CocosCreator/Creator/3.0.0/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/render-scene.ts"],"names":["RenderScene","root","_root","name","_name","cameras","_cameras","mainLight","_mainLight","sphereLights","_sphereLights","spotLights","_spotLights","models","_models","handle","_scenePoolHandle","batches","_batches","registerCreateFunc","_createSceneFun","constructor","_directionalLights","_modelId","NULL_HANDLE","_modelArrayHandle","_batchArrayHandle","_sphereLightsHandle","_spotLightsHandle","_createHandles","initialize","info","update","stamp","i","length","light","model","enabled","updateTransform","updateUBOs","destroy","removeCameras","removeSphereLights","removeSpotLights","removeModels","ModelArrayPool","free","ScenePool","LightArrayPool","UIBatchArrayPool","addCamera","cam","attachToScene","push","removeCamera","camera","splice","detachFromScene","setMainLight","dl","set","SceneView","MAIN_LIGHT","unsetMainLight","dlList","node","hasChangedFlags","TransformBit","ROTATION","addDirectionalLight","removeDirectionalLight","addSphereLight","pl","removeSphereLight","erase","addSpotLight","sl","removeSpotLight","clear","addModel","m","removeModel","addBatch","batch","removeBatch","removeBatches","onGlobalPipelineStateChanged","generateModelId","alloc","MODEL_ARRAY","SPOT_LIGHT_ARRAY","SPHERE_LIGHT_ARRAY","BATCH_ARRAY_2D"],"mappings":"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"}