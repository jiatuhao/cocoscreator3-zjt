{"version":3,"sources":["file:///Applications/CocosCreator/Creator/3.0.0/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/skybox.ts"],"names":["skybox_mesh","skybox_material","Skybox","model","_model","enabled","SkyboxPool","get","_handle","SkyboxView","ENABLE","val","activate","_updatePipeline","set","useIBL","USE_IBL","isRGBE","IS_RGBE","recompileShaders","USE_RGBE_CUBEMAP","setSubModelMaterial","envmap","_envmap","_default","legacyCC","director","root","pipeline","ambient","albedoArray","mipmapLevel","_updateGlobalBinding","handle","constructor","_globalDescriptorSet","NULL_HANDLE","alloc","initialize","skyboxInfo","descriptorSet","builtinResMgr","createModel","renderer","scene","Model","_initLocalDescriptors","MODEL","groundAlbedo","mat","Material","effectName","defines","MaterialInstance","parent","utils","createMesh","primitives","box","width","height","length","initSubModel","renderingSubMeshes","value","current","macros","CC_USE_IBL","onGlobalPipelineStateChanged","texture","getGFXTexture","sampler","samplerLib","getSampler","_device","getSamplerHash","bindSampler","UNIFORM_ENVIRONMENT_BINDING","bindTexture","destroy","free"],"mappings":"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"}